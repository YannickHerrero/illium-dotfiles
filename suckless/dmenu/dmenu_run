#!/bin/sh
# dmenu_run â€” launch executables, TUI apps, or web apps via dmenu
# TUI apps: ~/.config/tuiapps.conf (Name=command, opened inside st)
# Web apps: ~/.config/webapps.conf (Name=URL, opened in Firefox)

CONFIG_DIR="${XDG_CONFIG_HOME:-"$HOME/.config"}"
TUIAPPS_CONF="$CONFIG_DIR/tuiapps.conf"
WEBAPPS_CONF="$CONFIG_DIR/webapps.conf"
SCRIPTS_DIR="$CONFIG_DIR/scripts"

# Combine PATH executables with TUI and web app names
selection=$(
	{
		dmenu_path
		if [ -f "$TUIAPPS_CONF" ]; then
			sed -n 's/^\([^#][^=]*\)=.*/\1/p' "$TUIAPPS_CONF"
		fi
		if [ -f "$WEBAPPS_CONF" ]; then
			sed -n 's/^\([^#][^=]*\)=.*/\1/p' "$WEBAPPS_CONF"
		fi
	} | sort -u | dmenu "$@"
)

[ -z "$selection" ] && exit

# Check if selection matches a TUI app
if [ -f "$TUIAPPS_CONF" ]; then
	cmd=$(sed -n "s/^${selection}=//p" "$TUIAPPS_CONF" | head -1)
	if [ -n "$cmd" ]; then
		exec "$SCRIPTS_DIR/tuiapp-launch.sh" $cmd
	fi
fi

# Check if selection matches a web app
if [ -f "$WEBAPPS_CONF" ]; then
	url=$(sed -n "s/^${selection}=//p" "$WEBAPPS_CONF" | head -1)
	if [ -n "$url" ]; then
		exec "$SCRIPTS_DIR/webapp-launch.sh" "$url"
	fi
fi

# Otherwise execute as normal command
echo "$selection" | ${SHELL:-"/bin/sh"} &
